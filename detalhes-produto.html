<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Produto - Loja Educacional</title>
    <meta name="description" content="Veja todos os detalhes do produto educacional">
    <link rel="stylesheet" href="assets/css/styles-educacional.css">
</head>
<body>
    <!-- Cabe√ßalho -->
    <header class="header">
        <div class="container">
            <h1>üéì Loja Educacional</h1>
            <p>Materiais de qualidade para transformar sua pr√°tica pedag√≥gica</p>
        </div>
    </header>

    <!-- Navega√ß√£o -->
    <nav class="nav">
        <div class="container nav-container">
            <ul class="nav-links">
                <li><a href="index.html">üè† In√≠cio</a></li>
                <li><a href="sobre.html">üìñ Sobre</a></li>
                <li><a href="contato.html">üìû Contato</a></li>
            </ul>
            <div class="carrinho-info" onclick="abrirCarrinho()">
                üõí Carrinho
                <span class="carrinho-contador" id="carrinho-contador">0</span>
                <span id="carrinho-total">R$ 0,00</span>
            </div>
        </div>
    </nav>

    <!-- Conte√∫do Principal -->
    <main class="container">
        <!-- Breadcrumb -->
        <nav style="margin: 20px 0;">
            <a href="index.html" style="color: var(--cor-primaria); text-decoration: none;">‚Üê Voltar ao cat√°logo</a>
        </nav>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Carregando produto...</p>
        </div>

        <!-- Detalhes do Produto -->
        <section id="produto-detalhes" class="detalhes-produto" style="display: none;">
            <div class="detalhes-grid">
                <!-- Imagens do Produto -->
                <div class="detalhes-imagem-container">
                    <img id="imagem-principal" class="detalhes-produto-imagem-principal" src="" alt="">
                    <div id="miniaturas-container" class="detalhes-produto-miniaturas">
                        <!-- As miniaturas ser√£o carregadas aqui -->
                    </div>
                </div>

                <!-- Informa√ß√µes do Produto -->
                <div class="detalhes-info">
                    <h1 id="produto-nome">Nome do Produto</h1>
                    <div id="produto-preco" class="detalhes-preco">R$ 0,00</div>
                    <div id="produto-descricao" class="detalhes-descricao">
                        Descri√ß√£o do produto...
                    </div>
                    
                    <!-- Informa√ß√µes Adicionais -->
                    <div style="background-color: var(--cor-fundo); padding: var(--espacamento-grande); border-radius: var(--borda-radius); margin: var(--espacamento-grande) 0;">
                        <h3 style="color: var(--cor-primaria); margin-bottom: var(--espacamento-medio);">üìã Informa√ß√µes do Produto</h3>
                        <p><strong>C√≥digo:</strong> <span id="produto-codigo">-</span></p>
                        <p><strong>Formato:</strong> Digital (Download)</p>
                        <p><strong>Entrega:</strong> Imediata ap√≥s pagamento</p>
                    </div>

                    <!-- Bot√µes de A√ß√£o -->
                    <div style="display: flex; gap: var(--espacamento-medio); flex-wrap: wrap; margin-top: var(--espacamento-grande);">
                        <button id="btn-adicionar-carrinho" onclick="adicionarAoCarrinho()" class="btn btn-primario" style="flex: 1; min-width: 200px;">
                            üõí Adicionar ao Carrinho
                        </button>
                        <button onclick="comprarAgora()" class="btn btn-secundario" style="flex: 1; min-width: 200px;">
                            ‚ö° Comprar Agora
                        </button>
                    </div>

                    <!-- Garantia e Seguran√ßa -->
                    <div style="margin-top: var(--espacamento-extra); padding: var(--espacamento-grande); background: linear-gradient(135deg, #E8F5E8, #F0F8FF); border-radius: var(--borda-radius); border-left: 4px solid var(--cor-primaria);">
                        <h3 style="color: var(--cor-primaria); margin-bottom: var(--espacamento-medio);">üõ°Ô∏è Garantia e Seguran√ßa</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: var(--espacamento-pequeno);">‚úÖ Pagamento 100% seguro</li>
                            <li style="margin-bottom: var(--espacamento-pequeno);">‚úÖ Download imediato ap√≥s pagamento</li>
                            <li style="margin-bottom: var(--espacamento-pequeno);">‚úÖ Suporte t√©cnico incluso</li>
                            <li style="margin-bottom: var(--espacamento-pequeno);">‚úÖ Satisfa√ß√£o garantida</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Erro -->
        <div id="erro-container" style="display: none;">
            <div class="mensagem mensagem-erro">
                <h3>‚ùå Produto n√£o encontrado</h3>
                <p id="erro-mensagem">N√£o foi poss√≠vel carregar os detalhes do produto.</p>
                <a href="index.html" class="btn btn-primario">üè† Voltar ao cat√°logo</a>
            </div>
        </div>
    </main>

    <!-- Modal do Carrinho -->
    <div id="modal-carrinho" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharCarrinho()">&times;</span>
            <h2>üõí Seu Carrinho</h2>
            <div id="carrinho-itens">
                <!-- Os itens do carrinho ser√£o carregados aqui -->
            </div>
            <div class="carrinho-total">
                Total: <span id="carrinho-total-modal">R$ 0,00</span>
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button onclick="limparCarrinho()" class="btn btn-secundario">üóëÔ∏è Limpar Carrinho</button>
                <button onclick="finalizarCompra()" class="btn btn-primario">üí≥ Finalizar Compra</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/cart.js"></script>
    <script>
        // ===== CONFIGURA√á√ÉO =====
        // IMPORTANTE: Substitua pela URL do seu Google Apps Script
        const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbxdipqQR3TXF5NGtiYD8B50oT26B9bgb4uytKM_1EinJs8F66-INc_dommnf0DF4M4wPA/exec';
        
        // ===== VARI√ÅVEIS GLOBAIS =====
        let produtoAtual = null;
        let imagensDisponiveis = [];

        // ===== INICIALIZA√á√ÉO =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando p√°gina de detalhes...');
            
            const urlParams = new URLSearchParams(window.location.search);
            const produtoId = urlParams.get('id');
            
            if (!produtoId) {
                mostrarErro('ID do produto n√£o fornecido na URL.');
                return;
            }
            
            carregarProduto(produtoId);
            atualizarCarrinhoUI();
        });

        // ===== CARREGAMENTO DO PRODUTO =====
        async function carregarProduto(produtoId) {
            try {
                mostrarLoading(true);
                esconderErro();
                
                console.log('üì° Buscando produto do backend...');
                const response = await fetch(BACKEND_URL);
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const produtos = await response.json();
                console.log('‚úÖ Produtos recebidos:', produtos);
                
                if (produtos.error) {
                    throw new Error(produtos.error);
                }
                
                produtoAtual = produtos.find(p => p.ID == produtoId);
                
                if (!produtoAtual) {
                    throw new Error('Produto n√£o encontrado.');
                }
                
                exibirProduto();
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar produto:', error);
                mostrarErro(`N√£o foi poss√≠vel carregar o produto: ${error.message}`);
            } finally {
                mostrarLoading(false);
            }
        }

        // ===== EXIBI√á√ÉO DO PRODUTO =====
        function exibirProduto() {
            if (!produtoAtual) return;
            
            // Atualizar t√≠tulo da p√°gina
            document.title = `${produtoAtual.Nome} - Loja Educacional`;
            
            // Preencher informa√ß√µes b√°sicas
            document.getElementById('produto-nome').textContent = produtoAtual.Nome;
            document.getElementById('produto-preco').textContent = `R$ ${formatarPreco(produtoAtual.Pre√ßo)}`;
            document.getElementById('produto-descricao').textContent = produtoAtual.Descri√ß√£o || 'Descri√ß√£o n√£o dispon√≠vel';
            document.getElementById('produto-codigo').textContent = produtoAtual.Codigo || 'N/A';
            
            // Configurar imagens
            configurarImagens();
            
            // Mostrar se√ß√£o de detalhes
            document.getElementById('produto-detalhes').style.display = 'block';
        }

        // ===== CONFIGURA√á√ÉO DE IMAGENS =====
        function configurarImagens() {
            imagensDisponiveis = [];
            
            // Adicionar imagem principal se dispon√≠vel
            if (produtoAtual.URL_Imagem) {
                imagensDisponiveis.push(produtoAtual.URL_Imagem);
            }
            
            // Adicionar imagens adicionais se dispon√≠veis (URL_Imagem2, URL_Imagem3, etc.)
            for (let i = 2; i <= 5; i++) {
                const campoImagem = `URL_Imagem${i}`;
                if (produtoAtual[campoImagem]) {
                    imagensDisponiveis.push(produtoAtual[campoImagem]);
                }
            }
            
            // Se n√£o h√° imagens, usar placeholder
            if (imagensDisponiveis.length === 0) {
                imagensDisponiveis.push('assets/images/placeholder.jpg');
            }
            
            // Configurar imagem principal
            const imagemPrincipal = document.getElementById('imagem-principal');
            imagemPrincipal.src = imagensDisponiveis[0];
            imagemPrincipal.alt = produtoAtual.Nome;
            imagemPrincipal.onerror = function() {
                this.src = 'assets/images/placeholder.jpg';
            };
            
            // Configurar miniaturas
            configurarMiniaturas();
        }

        function configurarMiniaturas() {
            const container = document.getElementById('miniaturas-container');
            
            if (imagensDisponiveis.length <= 1) {
                container.style.display = 'none';
                return;
            }
            
            container.innerHTML = imagensDisponiveis.map((url, index) => `
                <img src="${url}" 
                     alt="Imagem ${index + 1}" 
                     onclick="trocarImagemPrincipal('${url}')"
                     onerror="this.src='assets/images/placeholder.jpg'"
                     ${index === 0 ? 'class="active"' : ''}>
            `).join('');
            
            container.style.display = 'flex';
        }

        function trocarImagemPrincipal(novaUrl) {
            const imagemPrincipal = document.getElementById('imagem-principal');
            imagemPrincipal.src = novaUrl;
            
            // Atualizar classe active nas miniaturas
            const miniaturas = document.querySelectorAll('#miniaturas-container img');
            miniaturas.forEach(img => {
                img.classList.remove('active');
                if (img.src === novaUrl) {
                    img.classList.add('active');
                }
            });
        }

        // ===== CARRINHO =====
        function adicionarAoCarrinho() {
            if (!produtoAtual) return;
            
            adicionarItem(produtoAtual);
            mostrarMensagem(`‚úÖ ${produtoAtual.Nome} adicionado ao carrinho!`, 'sucesso');
            atualizarCarrinhoUI();
            
            // Feedback visual no bot√£o
            const btn = document.getElementById('btn-adicionar-carrinho');
            const textoOriginal = btn.innerHTML;
            btn.innerHTML = '‚úÖ Adicionado!';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.innerHTML = textoOriginal;
                btn.disabled = false;
            }, 2000);
        }

        function comprarAgora() {
            if (!produtoAtual) return;
            
            // Limpar carrinho e adicionar apenas este produto
            limparTodoCarrinho();
            adicionarItem(produtoAtual);
            
            // Redirecionar para finaliza√ß√£o (ou abrir modal de pagamento)
            alert('üí≥ Funcionalidade de compra direta ser√° implementada em breve!');
        }

        function abrirCarrinho() {
            document.getElementById('modal-carrinho').style.display = 'block';
            atualizarCarrinhoModal();
        }

        function fecharCarrinho() {
            document.getElementById('modal-carrinho').style.display = 'none';
        }

        function atualizarCarrinhoUI() {
            const carrinho = obterCarrinho();
            const contador = document.getElementById('carrinho-contador');
            const total = document.getElementById('carrinho-total');
            
            const totalItens = carrinho.reduce((sum, item) => sum + item.quantidade, 0);
            const totalPreco = carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);
            
            contador.textContent = totalItens;
            total.textContent = `R$ ${formatarPreco(totalPreco)}`;
        }

        function atualizarCarrinhoModal() {
            const carrinho = obterCarrinho();
            const container = document.getElementById('carrinho-itens');
            const totalModal = document.getElementById('carrinho-total-modal');
            
            if (carrinho.length === 0) {
                container.innerHTML = '<p class="text-center">üõí Seu carrinho est√° vazio</p>';
                totalModal.textContent = 'R$ 0,00';
                return;
            }
            
            container.innerHTML = carrinho.map(item => `
                <div class="carrinho-item">
                    <div>
                        <strong>${item.nome}</strong><br>
                        <small>R$ ${formatarPreco(item.preco)} x ${item.quantidade}</small>
                    </div>
                    <div>
                        <button onclick="alterarQuantidade(${item.id}, ${item.quantidade - 1})" class="btn btn-secundario" style="padding: 4px 8px;">-</button>
                        <span style="margin: 0 10px;">${item.quantidade}</span>
                        <button onclick="alterarQuantidade(${item.id}, ${item.quantidade + 1})" class="btn btn-secundario" style="padding: 4px 8px;">+</button>
                        <button onclick="removerItem(${item.id})" class="btn btn-secundario" style="padding: 4px 8px; margin-left: 10px;">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
            
            const total = carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);
            totalModal.textContent = `R$ ${formatarPreco(total)}`;
        }

        function alterarQuantidade(produtoId, novaQuantidade) {
            if (novaQuantidade <= 0) {
                removerItem(produtoId);
            } else {
                // Buscar produto para adicionar diferen√ßa
                if (produtoAtual && produtoAtual.ID == produtoId) {
                    adicionarItem(produtoAtual, novaQuantidade - obterQuantidadeItem(produtoId));
                }
            }
            atualizarCarrinhoUI();
            atualizarCarrinhoModal();
        }

        function limparCarrinho() {
            if (confirm('üóëÔ∏è Tem certeza que deseja limpar o carrinho?')) {
                limparTodoCarrinho();
                atualizarCarrinhoUI();
                atualizarCarrinhoModal();
                mostrarMensagem('üóëÔ∏è Carrinho limpo!', 'sucesso');
            }
        }

        async function finalizarCompra() {
            const carrinho = obterCarrinho();
            if (carrinho.length === 0) {
                alert('üõí Seu carrinho est√° vazio!');
                return;
            }
            
            // Aqui voc√™ pode implementar a integra√ß√£o com o Mercado Pago
            alert('üí≥ Funcionalidade de pagamento ser√° implementada em breve!');
        }

        // ===== UTILIT√ÅRIOS =====
        function formatarPreco(preco) {
            const numero = parseFloat(preco) || 0;
            return numero.toFixed(2).replace('.', ',');
        }

        function mostrarLoading(mostrar) {
            document.getElementById('loading').style.display = mostrar ? 'flex' : 'none';
            document.getElementById('produto-detalhes').style.display = mostrar ? 'none' : 'block';
        }

        function mostrarErro(mensagem) {
            document.getElementById('erro-mensagem').textContent = mensagem;
            document.getElementById('erro-container').style.display = 'block';
            document.getElementById('produto-detalhes').style.display = 'none';
        }

        function esconderErro() {
            document.getElementById('erro-container').style.display = 'none';
        }

        function mostrarMensagem(texto, tipo) {
            // Criar elemento de mensagem tempor√°ria
            const mensagem = document.createElement('div');
            mensagem.className = `mensagem mensagem-${tipo}`;
            mensagem.textContent = texto;
            mensagem.style.position = 'fixed';
            mensagem.style.top = '20px';
            mensagem.style.right = '20px';
            mensagem.style.zIndex = '1001';
            mensagem.style.maxWidth = '300px';
            
            document.body.appendChild(mensagem);
            
            // Remover ap√≥s 3 segundos
            setTimeout(() => {
                if (mensagem.parentNode) {
                    mensagem.parentNode.removeChild(mensagem);
                }
            }, 3000);
        }

        // ===== EVENT LISTENERS =====
        // Fechar modal ao clicar fora dele
        window.onclick = function(event) {
            const modal = document.getElementById('modal-carrinho');
            if (event.target === modal) {
                fecharCarrinho();
            }
        }
    </script>
</body>
</html>

